<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>비밀번호 찾기</title>
  <style>
    #temp-password-section { display: none; margin-top: 20px; }
    #result { margin-top: 15px; color: red; }
  </style>
</head>
<body>
<h2>비밀번호 찾기</h2>
<div id="find-password-section">
  <label>이메일 주소<br>
    <input type="email" id="email" required placeholder="가입한 이메일">
  </label>
  <button id="send-temp-password" type="button">임시 비밀번호 전송</button>
  <div id="result"></div>
</div>

<!-- 임시 비밀번호 입력/로그인 섹션 -->
<div id="temp-password-section">
  <label>임시 비밀번호<br>
    <input type="password" id="temp-password" required>
  </label>
  <button id="login-with-temp" type="button">로그인하기</button>
  <div id="login-result"></div>
</div>
<a href="/">메인으로</a>

<script>
  // 임시 비밀번호 전송
  document.getElementById('send-temp-password').onclick = function() {
    const email = document.getElementById('email').value;
    if (!email) {
      document.getElementById('result').textContent = '이메일을 입력하세요.';
      return;
    }
    fetch('/find-password/send', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ email })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        document.getElementById('result').textContent = '임시 비밀번호가 이메일로 전송되었습니다.';
        document.getElementById('send-temp-password').style.display = 'none';
        document.getElementById('temp-password-section').style.display = 'block';
      } else {
        document.getElementById('result').textContent = data.message || '전송 실패';
      }
    })
    .catch(() => {
      document.getElementById('result').textContent = '서버 오류가 발생했습니다.';
    });
  };

  // 임시 비밀번호로 로그인
  document.getElementById('login-with-temp').onclick = function() {
    const email = document.getElementById('email').value;
    const tempPassword = document.getElementById('temp-password').value;
    if (!tempPassword) {
      document.getElementById('login-result').textContent = '임시 비밀번호를 입력하세요.';
      return;
    }
    fetch('/find-password/login', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ email, password: tempPassword })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        // 바로 마이페이지 이동
        window.location.href = '/my-page';
      } else {
        document.getElementById('login-result').textContent = data.message || '로그인 실패';
      }
    })
    .catch(() => {
      document.getElementById('login-result').textContent = '서버 오류가 발생했습니다.';
    });
  };
</script>
</body>
</html>